.\" perpctl.8
.\" wcm, 2009.12.01 - 2010.01.01
.\" ===
.TH perpctl 8 "January 2010" "perp-0.00" "persistent process supervision"
.de ZZ
.  br
.  ns
..
.SH NAME
perpctl \- runtime control utility for
.BR perpetrate (8)
services
.SH SYNOPSIS
.B perpctl [-hV] [-b
.I basedir
.B ] [-L]
.I cmd sv
.B [
.I sv ...
.B ]
.SH DESCRIPTION
.B perpctl
sends the command specified in
.I cmd
to the
.BR perpetrate (8)
control interface for each active service argument
.IR sv .
.PP
The argument
.I cmd
may be given as a single word of any length,
but only the first letter is considered.
The available commands include
(with mnemonic in parentheses):
.PP
.B d
(down)
.RS
If the service is running,
send it a sequence of SIGTERM and SIGCONT signals to bring it down.
.BR perpetrate (8)
will flag the service as wanting down:
if the service stops it will not be restarted. 
.RE
.PP
.B u
(up)
.RS
If the service is not already running, start it.
.BR perpetrate (8)
will flag the service as wanting up:
if the service stops it will be restarted.
.RE
.PP
.B o
(once)
.RS
If the service is not already running, start it.
.BR perpetrate (8)
will flag the service to run once:
if the service stops it will not be restarted.
.RE
.PP
.B p
(pause)
.RS
Send the service a SIGSTOP signal.
Normally this suspends execution of the service.
.BR perpetrate (8)
will flag the service as paused.
.RE
.PP
.B c
(continue)
.RS
Send the service a SIGCONT signal.
Normally a paused service will then resume execution.
.BR perpetrate (8)
will remove a pause flag on the service.
.RE
.PP
.B a
(alarm)
.ZZ
.B h
(hup)
.ZZ
.B i
(interrupt)
.ZZ
.B k
(kill)
.ZZ
.B t
(term)
.ZZ
.B w
(winch)
.ZZ
.B 1
(usr1)
.ZZ
.B 2
(usr2)
.RS
Send the service a corresponding signal:
SIGALRM, SIGHUP, SIGINT, SIGKILL, SIGTERM, SIGWINCH, SIGUSR1 or SIGUSR2.
.RE
.PP
.B D
(meta-down)
.ZZ
.B U
(meta-up)
.RS
When given in upper-case, the
.B d
(down) and
.B u
(up) commands described above
are applied to both the main and log services.
.RE
.PP
.B X
(meta-exit)
.RS
After bringing down both the main and log services,
the
.BR perpetrate (8)
supervisor itself will then exit.
.RE
.PP
The commands above are used for controlling an active service process
correlating to the ``start'' target of its
.BR perpetrate (5)
runscript.
.BR perpetrate (8)
will otherwise ignore any of the commands described above
if received while a service is resetting,
except for the commands
.B c
(continue/SIGCONT)
or
.B k
(kill/SIGKILL).
.SH OPTIONS
.TP
.B \-b basedir
Base directory.
Sets the base directory containing the
.I sv
arguments.
If not set,
.B perpctl
will look for a value set in the environmental variable PERP_BASE.
If neither of these is set,
.B perpctl
will operate on the current working directory.
.TP
.B \-h
Help.
Print a brief usage message to stderr and exit.
.TP
.B \-L
Logger.
Apply the
.I cmd
argument to the active logging services found in
.I sv
services.
By default, the
.I cmd
argument is applied to the main service.
The
.B \-L
option is not allowed when using any of the meta-commands
.BR D ", " U ", or " X .
.TP
.B \-V
Version.
Print the version number of the program to stderr and exit.
.SH DIAGNOSTICS
For each
.I sv
successfully processed,
.B perpctl
prints a line to stderr in the form:
.IP
.IR sv :
ok
.PP
For each
.I sv
not successfully processed,
.B perpctl
prints a brief diagnostic to stderr and continues processing any remaining
.IR sv .
.SH EXIT STATUS
.PP
.B perpctl
exits with one of the following values:
.TP
0
Success.
The
.I cmd
was successfully delivered to all
.I sv
service arguments.
.TP
100
Usage error.
For unknown options, missing arguments, or other command-line errors.
Prints a brief diagnostic message to stderr on exit.
.TP
111
System error.
One or more errors were encountered while processing.
These may include unexpected failures of system calls,
privilege and/or resource problems,
or configuration errors in the base directory.
A brief diagnostic message is printed to stderr for each error encountered.
.SH AUTHOR
Wayne Marshall, http://b0llix.net/perp/
.SH SEE ALSO
.nh
.BR perp_intro (8),
.BR perpboot (8),
.BR perpd (8),
.BR perpetrate (5),
.BR perpetrate (8),
.BR perphup (8),
.BR perpls (8),
.BR perpok (8),
.BR perpstat (8),
.BR sissylog (8),
.BR tinylog (8)
.\" eof
